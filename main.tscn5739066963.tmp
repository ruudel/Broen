[gd_scene load_steps=24 format=3 uid="uid://dgpk5jx7jj0ac"]

[ext_resource type="Script" uid="uid://c1sur85g7a384" path="res://world.gd" id="1_0xm2m"]
[ext_resource type="Script" uid="uid://couw105c3bde4" path="res://addons/godot_state_charts/state_chart.gd" id="2_lquwl"]
[ext_resource type="Script" uid="uid://duyew1ww78fua" path="res://background.gd" id="2_w48qg"]
[ext_resource type="Script" uid="uid://jk2jm1g6q853" path="res://addons/godot_state_charts/compound_state.gd" id="3_7mycd"]
[ext_resource type="Texture2D" uid="uid://dapcp2lediy6a" path="res://assets/Sprites/Backgrounds/Default/background_fade_hills.png" id="3_vivmo"]
[ext_resource type="Script" uid="uid://cytafq8i1y8qm" path="res://addons/godot_state_charts/atomic_state.gd" id="4_272bh"]
[ext_resource type="Script" uid="uid://cf1nsco3w0mf6" path="res://addons/godot_state_charts/transition.gd" id="5_7mycd"]
[ext_resource type="PackedScene" uid="uid://bxgaw10fs18br" path="res://player.tscn" id="5_lquwl"]
[ext_resource type="PackedScene" uid="uid://bh7ltq6ynwmq0" path="res://home_town.tscn" id="7_5vw27"]
[ext_resource type="FontFile" uid="uid://jkqo7qhhtp16" path="res://assets/Fonts/NotoSans-Regular.ttf" id="7_272bh"]
[ext_resource type="Script" uid="uid://7m7l8kyskbla" path="res://home_town.gd" id="8_efxa6"]
[ext_resource type="Script" uid="uid://co33pli64pi4a" path="res://town_label.gd" id="9_4c57u"]
[ext_resource type="Texture2D" uid="uid://b7yli001yvidy" path="res://assets/Sheets/UI/Default/Divider Fade/divider-fade-001.png" id="9_kek77"]
[ext_resource type="FontFile" uid="uid://bcv8psb2ismg1" path="res://assets/Fonts/caslonantique.ttf" id="10_dg77c"]
[ext_resource type="Texture2D" uid="uid://ceic3cifvpmbh" path="res://assets/Sheets/UI/Default/Panel/panel-005.png" id="12_2cqfq"]
[ext_resource type="Texture2D" uid="uid://uusxa15d3g8h" path="res://assets/Sheets/UI/Default/Panel/panel-015.png" id="14_yaehf"]

[sub_resource type="LabelSettings" id="LabelSettings_5vw27"]
font = ExtResource("7_272bh")
font_size = 32
outline_size = 8
outline_color = Color(0.162066, 0.162066, 0.162066, 1)
shadow_size = 0

[sub_resource type="CanvasTexture" id="CanvasTexture_074og"]

[sub_resource type="LabelSettings" id="LabelSettings_2cqfq"]
font = ExtResource("10_dg77c")
font_size = 24

[sub_resource type="LabelSettings" id="LabelSettings_efxa6"]
font = ExtResource("10_dg77c")
font_size = 32
outline_size = 8
outline_color = Color(0.879436, 0.491758, 0.765502, 1)

[sub_resource type="Animation" id="Animation_4c57u"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("TownLabel:modulate:a")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [0.0]
}

[sub_resource type="Animation" id="Animation_kek77"]
resource_name = "fade_town_label"
length = 4.0
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("TownLabel:modulate:a")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 1, 3, 4),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 0,
"values": [0.0, 1.0, 1.0, 0.0]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_4c57u"]
_data = {
&"RESET": SubResource("Animation_4c57u"),
&"fade_town_label": SubResource("Animation_kek77")
}

[node name="World" type="Node2D"]
script = ExtResource("1_0xm2m")

[node name="Background" type="Node2D" parent="."]
script = ExtResource("2_w48qg")

[node name="SpriteA" type="Sprite2D" parent="Background"]
texture_repeat = 2
scale = Vector2(1.49609, 1.49609)
texture = ExtResource("3_vivmo")
offset = Vector2(128, 128)

[node name="SpriteB" type="Sprite2D" parent="Background"]
texture_repeat = 2
position = Vector2(383, 0)
scale = Vector2(1.49609, 1.49609)
texture = ExtResource("3_vivmo")
offset = Vector2(128, 128)

[node name="SpriteC" type="Sprite2D" parent="Background"]
texture_repeat = 2
position = Vector2(765, 0)
scale = Vector2(1.49609, 1.49609)
texture = ExtResource("3_vivmo")
offset = Vector2(128, 128)

[node name="StateChart" type="Node" parent="."]
script = ExtResource("2_lquwl")
metadata/_custom_type_script = "uid://couw105c3bde4"

[node name="Root" type="Node" parent="StateChart"]
script = ExtResource("3_7mycd")
initial_state = NodePath("Dialog")

[node name="Stopped" type="Node" parent="StateChart/Root"]
script = ExtResource("4_272bh")

[node name="ToMoving" type="Node" parent="StateChart/Root/Stopped"]
script = ExtResource("5_7mycd")
to = NodePath("../../Moving")
event = &"player_walking"
delay_in_seconds = "0.0"

[node name="ToDialog" type="Node" parent="StateChart/Root/Stopped"]
script = ExtResource("5_7mycd")
to = NodePath("../../Dialog")
event = &"dialog_open"
delay_in_seconds = "0.0"

[node name="Moving" type="Node" parent="StateChart/Root"]
script = ExtResource("4_272bh")

[node name="ToStopped" type="Node" parent="StateChart/Root/Moving"]
script = ExtResource("5_7mycd")
to = NodePath("../../Stopped")
event = &"player_stopped"
delay_in_seconds = "0.0"

[node name="ToDialog" type="Node" parent="StateChart/Root/Moving"]
script = ExtResource("5_7mycd")
to = NodePath("../../Dialog")
event = &"dialog_open"
delay_in_seconds = "0.0"

[node name="Dialog" type="Node" parent="StateChart/Root"]
script = ExtResource("4_272bh")

[node name="ToStopped" type="Node" parent="StateChart/Root/Dialog"]
script = ExtResource("5_7mycd")
to = NodePath("../../Stopped")
event = &"player_stopped"
delay_in_seconds = "0.0"

[node name="Player" parent="." instance=ExtResource("5_lquwl")]
position = Vector2(128, 325)

[node name="HomeTown" parent="." instance=ExtResource("7_5vw27")]
script = ExtResource("8_efxa6")

[node name="Distance" type="Label" parent="."]
top_level = true
z_index = 10
z_as_relative = false
offset_left = 449.0
offset_top = 319.0
offset_right = 642.0
offset_bottom = 385.0
label_settings = SubResource("LabelSettings_5vw27")

[node name="GUI" type="CanvasLayer" parent="."]

[node name="EventDialog" type="NinePatchRect" parent="GUI"]
visible = false
self_modulate = Color(0.124692, 0.228561, 0.2064, 1)
offset_left = 260.0
offset_top = 64.0
offset_right = 421.0
offset_bottom = 269.0
texture = ExtResource("12_2cqfq")
patch_margin_left = 16
patch_margin_top = 16
patch_margin_right = 16
patch_margin_bottom = 16
metadata/_edit_group_ = true

[node name="TextureRect" type="TextureRect" parent="GUI/EventDialog"]
modulate = Color(0, 0.996078, 0.835294, 1)
z_index = -2
layout_mode = 0
offset_right = 161.0
offset_bottom = 205.0
texture = SubResource("CanvasTexture_074og")

[node name="Label" type="Label" parent="GUI/EventDialog"]
self_modulate = Color(0.596213, 0.752663, 0.399232, 1)
layout_mode = 0
offset_left = 14.0
offset_top = 10.0
offset_right = 147.0
offset_bottom = 84.0
label_settings = SubResource("LabelSettings_2cqfq")
horizontal_alignment = 1
autowrap_mode = 2

[node name="Button" type="Button" parent="GUI/EventDialog"]
layout_mode = 0
offset_left = 14.0
offset_top = 89.0
offset_right = 147.0
offset_bottom = 121.0
flat = true

[node name="NinePatchRect" type="NinePatchRect" parent="GUI/EventDialog/Button"]
self_modulate = Color(0, 0.994414, 0.836148, 1)
layout_mode = 0
offset_right = 133.0
offset_bottom = 32.0
texture = ExtResource("14_yaehf")
patch_margin_left = 16
patch_margin_top = 16
patch_margin_right = 16
patch_margin_bottom = 16

[node name="Button2" type="Button" parent="GUI/EventDialog"]
layout_mode = 0
offset_left = 14.0
offset_top = 125.0
offset_right = 147.0
offset_bottom = 157.0
flat = true

[node name="NinePatchRect" type="NinePatchRect" parent="GUI/EventDialog/Button2"]
self_modulate = Color(0, 0.994414, 0.836148, 1)
layout_mode = 0
offset_right = 133.0
offset_bottom = 32.0
texture = ExtResource("14_yaehf")
patch_margin_left = 16
patch_margin_top = 16
patch_margin_right = 16
patch_margin_bottom = 16

[node name="Button3" type="Button" parent="GUI/EventDialog"]
layout_mode = 0
offset_left = 14.0
offset_top = 161.0
offset_right = 147.0
offset_bottom = 193.0
flat = true

[node name="NinePatchRect" type="NinePatchRect" parent="GUI/EventDialog/Button3"]
self_modulate = Color(0, 0.994414, 0.836148, 1)
layout_mode = 0
offset_right = 133.0
offset_bottom = 32.0
texture = ExtResource("14_yaehf")
patch_margin_left = 16
patch_margin_top = 16
patch_margin_right = 16
patch_margin_bottom = 16

[node name="TownLabel" type="Label" parent="GUI"]
modulate = Color(0.837895, 0.667614, 0.504075, 0)
offset_left = 309.0
offset_top = 16.0
offset_right = 349.0
offset_bottom = 64.0
label_settings = SubResource("LabelSettings_efxa6")
horizontal_alignment = 1
vertical_alignment = 1
uppercase = true
script = ExtResource("9_4c57u")

[node name="LabelLeft" type="TextureRect" parent="GUI/TownLabel"]
layout_mode = 0
offset_right = 96.0
offset_bottom = 40.0
texture = ExtResource("9_kek77")

[node name="LabelRight" type="TextureRect" parent="GUI/TownLabel"]
layout_mode = 0
offset_right = 96.0
offset_bottom = 40.0
texture = ExtResource("9_kek77")
flip_h = true

[node name="FadeTownLabel" type="AnimationPlayer" parent="GUI"]
libraries = {
&"": SubResource("AnimationLibrary_4c57u")
}
autoplay = "fade_town_label"

[connection signal="state_entered" from="StateChart/Root/Stopped" to="." method="_on_idle_state_entered"]
[connection signal="state_processing" from="StateChart/Root/Stopped" to="." method="_on_idle_state_processing"]
[connection signal="state_entered" from="StateChart/Root/Moving" to="." method="_on_moving_state_entered"]
[connection signal="state_processing" from="StateChart/Root/Moving" to="." method="_on_moving_state_processing"]
[connection signal="state_entered" from="StateChart/Root/Dialog" to="." method="_on_dialog_state_entered"]
[connection signal="state_exited" from="StateChart/Root/Dialog" to="." method="_on_dialog_state_exited"]
